```markdown
# 70_workflow.md — Процесс создания новой страницы

## Этапы разработки страницы

### Этап 1: Анализ и проектирование
- [ ] Определить, какие данные нужны на странице
- [ ] Выявить используемые сущности (Order, User, Hardware и т.д.)
- [ ] Определить, какие API эндпоинты потребуются
- [ ] Разбить страницу на смысловые блоки (виджеты)
- [ ] Выделить повторяющиеся UI-элементы

### Этап 2: Сущности (entities)
- [ ] Проверить, существуют ли нужные сущности в `packages/entities/`
- [ ] Если нет — создать новые сущности по инструкции `10_entities.md`
- [ ] Если есть — проверить, покрывают ли они нужные данные
- [ ] Дополнить существующие сущности новыми полями/методами (не ломая обратную совместимость)

### Этап 3: Бизнес-логика (features)
- [ ] Создать MobX store для страницы в `src/features/[module]/[page-name]-model.ts`
- [ ] Описать состояние страницы (loading, error, data, filters и т.д.)
- [ ] Реализовать методы загрузки данных (через API сущностей)
- [ ] Реализовать методы обработки действий (сабмиты, обновления)
- [ ] Подключить глобальные сторы из entities если нужно

### Этап 4: Виджеты (widgets)
- [ ] Разбить страницу на виджеты в `packages/widgets/[module]/[widget-name]/`
- [ ] Каждый виджет получает данные через props
- [ ] Виджеты не вызывают API напрямую (только через колбэки из props)
- [ ] Виджеты содержат свою внутреннюю UI-логику (открытие/закрытие, локальные стейты)

### Этап 5: Страница (app)
- [ ] Создать файл страницы в `src/app/(moduls)/[module]/[page-name]/index.tsx`
- [ ] Подключить созданный store из features
- [ ] Загрузить данные при монтировании (useEffect)
- [ ] Собрать виджеты в правильной композиции
- [ ] Передать данные и колбэки в виджеты

### Этап 6: Навигация
- [ ] Добавить ссылку на страницу в соответствующих местах
- [ ] Если нужно — создать `_layout.tsx` для группы страниц
- [ ] Настроить параметры навигации (заголовки, жесты)
- [ ] Проверить передачу параметров через useLocalSearchParams()

## Правила добавления в существующую структуру

### НИКОГДА НЕ ИЗМЕНЯТЬ:
- Существующие файлы (только дополнять новыми функциями/методами)
- Публичное API существующих модулей без крайней необходимости
- Сигнатуры существующих функций (менять можно только добавляя опциональные параметры)
- Структуру папок shared (она будет рефакториться позже)

### МОЖНО И НУЖНО:
- Создавать новые файлы в правильных директориях
- Добавлять новые экспорты в существующие index.ts
- Создавать новые папки для новых модулей/фич
- Дополнять существующие сущности новыми типами и методами

### Проверка совместимости:
```typescript
// ПЛОХО: меняем существующую функцию
export function getOrder(id: string) { ... } // Было
export function getOrder(id: number) { ... } // Стало — сломает код

// ХОРОШО: добавляем новую
export function getOrder(id: string) { ... }
export function getOrderById(id: string) { ... } // Новая функция
export function getOrderByNumber(number: string) { ... } // Новая функция
```

## Правила именования

### Папки:
- Сущности, фичи, виджеты — kebab-case: `order-list`, `hardware-form`
- Модули в app — kebab-case: `dispatcher`, `domain`
- Группы роутов — (kebab-case): `(auth)`, `(moduls)`

### Файлы:
- Компоненты — kebab-case: `order-card.tsx`, `hardware-list.tsx`
- Модели — kebab-case с суффиксом: `order-model.ts`, `hardware-form-model.ts`
- Типы — `type.ts` или kebab-case: `order-types.ts`
- API — `api.ts` или kebab-case: `order-api.ts`
- Утилиты — kebab-case: `format-date.ts`, `validate-email.ts`

### Экспорты:
- Компонент — `export default function OrderCard()`
- Стор — `export const orderStore = new OrderStore()`
- Типы — `export type { Order, OrderStatus }`
- Утилиты — именованный экспорт

## Процесс ревью (перед коммитом)

- [ ] Типы добавлены для всех данных
- [ ] Нет импортов с верхних слоев в нижние
- [ ] Нет дублирования кода (проверить shared)
- [ ] Стор не делает лишних запросов при монтировании
- [ ] Обработаны состояния loading/error
- [ ] Компоненты разбиты на переиспользуемые части
- [ ] Имена соответствуют правилам
- [ ] Нет закомментированного кода
- [ ] Нет console.log (только если временно)

## Типичные ошибки

❌ Импорт из app в features
❌ Прямые запросы в виджете
❌ Изменение существующего API сущности
❌ Создание новой сущности, когда можно дополнить существующую
❌ Дублирование UI-компонентов вместо использования shared-ui
❌ Использование относительных путей (../../../)
❌ Стейт страницы в компоненте, а не в модели

## Чек-лист перед созданием страницы

```
Название страницы: _________________
Модуль: _________________
Путь: src/app/(moduls)/_______________/_______________/

Нужные сущности:
□ _________________ (существует / будет создана)
□ _________________ (существует / будет создана)

Нужные фичи:
□ _________________ (модель для страницы)
□ _________________ (доп. логика)

Планируемые виджеты:
□ _________________
□ _________________

Параметры навигации:
□ Статический роут
□ Динамический ([id])
□ Нужен layout
```